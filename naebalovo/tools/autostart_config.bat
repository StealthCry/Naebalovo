@echo off
setlocal enabledelayedexpansion
chcp 65001 >nul
title –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ Naebalovo

:: === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ===
set "APP_NAME=Naebalovo"
set "TASK_NAME=%APP_NAME%_Hidden_Startup"
set "BATCH_FILE=%~dp0..\NAEBALOVO.bat"
set "WORK_DIR=%~dp0.."

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
echo –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞...
net session >nul 2>&1
if %errorlevel% neq 0 (
    echo ‚ùå –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!
    echo –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
    echo.
    pause
    exit /b 1
)

cls
echo ========================================
echo     –ù–ê–°–¢–†–û–ô–ö–ê –ê–í–¢–û–ó–ê–ü–£–°–ö–ê NAE–¨ALOVO
echo ========================================
echo.
echo –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç —Å–∫—Ä—ã—Ç—ã–π –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
echo Naebalovo –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.
echo.
echo ‚úî –ë–µ–∑ –≤–∏–¥–∏–º—ã—Ö –æ–∫–æ–Ω
echo ‚úî –ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
echo ‚úî –ó–∞–ø—É—Å–∫ –æ—Ç SYSTEM
echo.
echo ========================================
echo.

:: –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏
echo [1/4] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á...
schtasks /delete /tn "%APP_NAME%" /f 2>nul
schtasks /delete /tn "%TASK_NAME%" /f 2>nul
echo ‚úî –°—Ç–∞—Ä—ã–µ –∑–∞–¥–∞—á–∏ —É–¥–∞–ª–µ–Ω—ã

:: –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–∫—Ä—ã—Ç—É—é –∑–∞–¥–∞—á—É
echo [2/4] –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–π –∑–∞–¥–∞—á–∏...
schtasks /create /tn "%TASK_NAME%" ^
    /tr "\"cmd.exe\" /c \"\"%BATCH_FILE%\" --silent-autostart\"" ^
    /sc onlogon ^
    /ru "SYSTEM" ^
    /rl highest ^
    /it ^
    /f >nul 2>&1

if %errorlevel% equ 0 (
    echo ‚úî –°–∫—Ä—ã—Ç–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞: %TASK_NAME%
) else (
    echo ‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏
    echo –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
    echo schtasks /create /tn "%TASK_NAME%" /tr "cmd /c \"\"%BATCH_FILE%\" --silent-autostart\"" /sc onlogon /ru SYSTEM /rl highest /it /f
    pause
    exit /b 1
)

:: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—á–∏
echo [3/4] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–¥–∞—á–∏...
schtasks /change /tn "%TASK_NAME%" ^
    /disable:no ^
    /ru "SYSTEM" ^
    /rp "*" ^
    /rl highest >nul 2>&1

:: –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—ã–π VBS –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
echo [4/4] –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞...
set "VBS_FILE=%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\_naebalovo_hidden.vbs"
(
echo Set WshShell = CreateObject^("WScript.Shell"^)
echo WshShell.CurrentDirectory = "%WORK_DIR:\=/%"
echo WshShell.Run "cmd /c \""\"%WORK_DIR:\=/%/NAEBALOVO.bat\" --silent-autostart\"", 0, False
) > "%VBS_FILE%" 2>nul

if exist "%VBS_FILE%" (
    attrib +h +s "%VBS_FILE%"
    echo ‚úî –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω –∏ —Å–∫—Ä—ã—Ç
) else (
    echo ‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
)

:: –°–æ–∑–¥–∞–µ–º –ª–æ–≥-—Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
set "CONFIG_FILE=%WORK_DIR%\autostart_config.log"
(
echo ========================================
echo –ê–í–¢–û–ó–ê–ü–£–°–ö –ù–ê–°–¢–†–û–ï–ù: %date% %time%
echo ========================================
echo –ò–º—è –∑–∞–¥–∞—á–∏: %TASK_NAME%
echo –§–∞–π–ª –∑–∞–ø—É—Å–∫–∞: %BATCH_FILE%
echo –†–∞–±–æ—á–∞—è –ø–∞–ø–∫–∞: %WORK_DIR%
echo –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: SYSTEM
echo –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç: %VBS_FILE%
echo ========================================
) > "%CONFIG_FILE%"

cls
echo ========================================
echo     –ù–ê–°–¢–†–û–ô–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê –£–°–ü–ï–®–ù–û!
echo ========================================
echo.
echo ‚úÖ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:
echo.
echo 1. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (–æ—Å–Ω–æ–≤–Ω–æ–π)
echo    ‚îî‚îÄ –ó–∞–¥–∞—á–∞: %TASK_NAME%
echo    ‚îî‚îÄ –ó–∞–ø—É—Å–∫: –ü—Ä–∏ –≤—Ö–æ–¥–µ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
echo    ‚îî‚îÄ –ü—Ä–∞–≤–∞: SYSTEM (–≤—ã—Å—à–∏–µ)
echo.
echo 2. –ü–∞–ø–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
echo    ‚îî‚îÄ –§–∞–π–ª: _naebalovo_hidden.vbs
echo    ‚îî‚îÄ –°–∫—Ä—ã—Ç: –î–∞
echo.
echo ‚ö° –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤–∫–ª—é—á–µ–Ω–∏–∏ –ü–ö:
echo    ‚Ä¢ Naebalovo –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
echo    ‚Ä¢ –û–∫–Ω–∞ –Ω–µ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
echo    ‚Ä¢ –ú–µ—Ç–æ–¥ –æ–±—Ö–æ–¥–∞: –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π
echo.
echo üîß –î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:
echo    ‚Ä¢ –£–¥–∞–ª–∏—Ç–µ –∑–∞–¥–∞—á—É '%TASK_NAME%' –∏–∑ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
echo    ‚Ä¢ –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ autostart_remove.bat
echo.
echo üìù –õ–æ–≥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: autostart_config.log
echo ========================================
echo.
pause